# 合约部分说明
## 合约分类
### Nfticket 主合约
1. 主合约是整个系统的主入口；
2. 主合约会负责NFT门票相关的创建；
3. 通过主合约可以添加和维护合约模板；
4. 因为基础活动数据和活动状态保存在主合约上，所以修改活动基本信息和状态需要通过主合约；
5. 添加活动以及购票都是通过模板合约、活动合约，主合约相应的接口也仅限模板或者活动合约调用；
### online 在线活动模板合约
1. 负责在线活动的创建以及模板管理
### online/meeting 在线活动合约
1. 负责在线活动的管理、购票、售票等；
### offline 线下活动模板合约
1. 负责线下活动的初始创建及模板管理
### offline/meeting 线下活动合约
1. 负责显现活动的配置管理、购票、验票

## 部署流程
1. 部署主合约 nftmart ，需要设置：
	1. min_create_meeting_fee 最小创建活动的代币数量
	2. min_create_ticket_fee 创建门票最小需要的代币数量
2. 部署在线活动相关合约
	1. 添加活动合约 online/meeting，获得合约 hash (最新的官方前端不能只上传，必须部署)
	2. 部署活动模板合约 online ，需要设置
		1. controller：主合约地址（不可修改）
		2. meeting_hash: 活动合约hash 值（通过上一步获得）
		3. min_endowment：部署活动合约最少的部署成本（需要保持活动合约有效的必要质押）
3. 部署线下活动相关合约（与部署在线合约相似）

## 核心方法
### 主合约 (nfticket)
#### 添加模板 (add_template)
1. 在主合约中添加活动模板合约，可以方便主合约对模板合约提供支持和管理；
2. 该方法仅允许主合约管理员调用
##### 参数说明
1. template_addr ：活动模板合约部署的地址
2. name : 模板名称
3. desc : 模板描述
4. uri : 模板的介绍网址
5. ratio : 该模板合约的服务费分成比例（百万分之 N）
#### 添加活动( add_meeting )
1. 通过向主合约提交活动基本信息，可以让外界通过主合约查询活动列表；
2. 该方法仅允许通过模板合约调用；
##### 参数说明
1. meeting_addr : 活动合约地址
2. name : 活动名称
3. desc : 活动描述
4. poster : 活动海报（IPFS 文件）
5. uri : 活动网址
6. start_time : 活动开始时间
7. end_time : 活动截止时间
8. start_sale_time : 活动门票开始售卖时间
9. end_sale_time : 活动门票结束售卖时间
####  创建门票NFT( create_ticket )
1. 创建门票NFT必须通过主合约来创建，因为主合约才有创建NFT的白名单资格；
2. 创建门票NFT必须支付一定费用；
#####  参数说明
1. buyer : 门票购买者，创建成功后，该门票将转给该购买者
2. metadata : 门票NFT 的扩展信息
### 模板合约( online or offline )
#### 创建活动 ( create_meeting )
通过模板合约的创建活动方法，将部署一个活动合约，然后调用主合约的 add_meeting 方法，登记一个新活动。
##### 参数说明
1. name : 活动名称
2. desc : 活动描述
3. poster : 活动海报
4. uri : 活动网址
5. start_time : 活动开始时间
6. end_time : 活动截止时间
7. start_sale_time : 活动门票开始售卖时间
8. end_sale_time : 活动门票结束售卖时间
### 活动合约 ( online/meeting or offline/meeting )
#### 购买门票 ( buy_ticket )
购买门票的接口，不同的活动，可能购买门票需要不同的信息。比如在线活动，只需要提供数量即可。但是对于线下活动，需要指定座位信息。
##### 参数说明(在线活动)
1. amount : 购票数量（一次购买太多，可能会出现问题）
##### 参数说明(线下活动)
1. zone : 所选座位区域
2. row : 所选座位的第几排
3. col : 所选座位的第几号
